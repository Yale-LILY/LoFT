# LoFT Framework
We provide the model checkpoints and output files in [Google Drive](https://drive.google.com/drive/folders/1A2zkN00KJCLc2fq4QR9u0InGLD72HVyC?usp=sharing). The overall file structure can be viewed at `file_structure.txt`. Create a virtual environment and run 
```shell
pip install -r requirements.txt
```

## 1. LoFT Training and Inference
Create a virtual environment and run 
```shell
pip install -r requirements.txt
```

### 1.1 Process LoFT Training and Inference Data
prepare `processed_LoFT_data/LoFT_inference_input.json` and `LoFT_framework/processed_LoFT_data/LoFT_train_input.json` generated by the *LoFT Data Processing* module. Run
```shell
python process_LoFT_data.py
```
Copy `bart.large/dict.txt` to `bart.large/dict.src.txt` and `bart.large/dict.tgt.txt`.

### 1.2 LoFT Training
```shell
python run_LoFT.py train --max-tokens 4096 --total-num-update 5000
```
You can specify other training parameters in `run_LoFT.py`.

### 1.3. LoFT Inference
After training the LoFT model, you can specify the path in `run_LoFT.py`, and run following commands to generate the raw output file.
```shell
python run_LoFT.py eval --model-path [checkpoint]
```
where `[checkpoint]` is the checkpoint file of the LoFT model, for example, `loft_checkpoint/checkpoint_best.pt`.

## 2. Statement Verifier Training and Inference
We used a RoBERTa-large based verifier to filter out those unfaithful generation.

### 2.1 Statement Verifier Training
Run following command to run the verifier training over TabFact dataset.
```shell
bash run_verifier.sh
```
The checkpoints will be saved in `verifier_exp/`.

### 2.2 Statement Verifier Inference
Run following command to prepare the inference data from the raw output of LoFT
```shell
python process_LoFT_data.py
```
Then run following command to run the verifier inference
```shell
python python run_verifier.py \
    --do_predict \
    --test_file LoFT_predict/inference_verifier_input.json \
    --output_dir . \
    --model_name_or_path [checkpoint dir path] \
```
where `[checkpoint dir path]` is the path to the checkpoint directory of the verifier model, for example, `verifier_exp/checkpoint-5000`. 

## 3. Prepare Evaluation File
Run following command to prepare the evaluation file for LogicNLG
```shell
prepare_evaluation_data.py
```
The final evaluation file will be saved in `LoFT_predict/evaluation.json`, which will then be used in the *LoFT Evaluation* module.
